// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  email            String            @id
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  nombre           String            @db.VarChar(64)
  apellido         String            @db.VarChar(64)
  password         String
  telefono         String            @db.VarChar(10)
  direccion        String            @db.VarChar(128)
  ciudad           String            @db.VarChar(64)
  codigoPostal     String            @db.VarChar(5)
  estado           String            @db.VarChar(64)
  pais             String            @db.VarChar(64)
  profilePic       String
  resenasProducto  ResenaProducto[]
  resenasProveedor ResenaProveedor[]
  pedidos          Pedido[]
}

model Categoria {
  id        Int        @id @default(autoincrement())
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  nombre    String     @db.VarChar(64)
  productos Producto[]
}

model CategoriaProveedor {
  id          Int         @id @default(autoincrement())
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  nombre      String      @db.VarChar(64)
  proveedores Proveedor[]
}

model Proveedor {
  email           String             @id
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt
  nombre          String             @db.VarChar(64)
  password        String
  tipo            TipoProveedor
  idCategoria     Int
  categoria       CategoriaProveedor @relation(fields: [idCategoria], references: [id])
  telefono        String             @db.VarChar(10)
  direccion       String             @db.VarChar(128)
  ciudad          String             @db.VarChar(64)
  codigoPostal    String             @db.VarChar(5)
  estado          String             @db.VarChar(64)
  pais            String             @db.VarChar(64)
  profilePic      String
  coordX          Float
  coordY          Float
  productos       Producto[]
  resenas         ResenaProveedor[]
  pedidoProveedor PedidoProveedor[]
}

model Producto {
  id          Int               @id @default(autoincrement())
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  nombre      String            @db.VarChar(64)
  descripcion String            @db.VarChar(256)
  precio      Float
  tipo        TipoProducto
  idProveedor String
  proveedor   Proveedor         @relation(fields: [idProveedor], references: [email])
  idCategoria Int
  imagen      String
  categoria   Categoria         @relation(fields: [idCategoria], references: [id])
  resenas     ResenaProducto[]
  pedidos     ProductosPedido[]
}

enum TipoProveedor {
  proveedor
  restaurante
}

enum TipoProducto {
  producto
  platillo
}

model ResenaProducto {
  id           Int      @id @default(autoincrement())
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  resena       String   @db.VarChar(128)
  calificacion Int
  idUsuario    String
  usuario      Usuario  @relation(fields: [idUsuario], references: [email])
  idProducto   Int
  producto     Producto @relation(fields: [idProducto], references: [id])
}

model ResenaProveedor {
  id           Int       @id @default(autoincrement())
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  resena       String    @db.VarChar(128)
  calificacion Int
  idUsuario    String
  usuario      Usuario   @relation(fields: [idUsuario], references: [email])
  idProveedor  String
  proveedor    Proveedor @relation(fields: [idProveedor], references: [email])
}

model Pedido {
  id              Int               @id @default(autoincrement())
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  estado          estadoPedido
  idUsuario       String
  usuario         Usuario           @relation(fields: [idUsuario], references: [email])
  pagado          Boolean
  productos       ProductosPedido[]
  pedidoProveedor PedidoProveedor[]
}

model PedidoProveedor {
  id          Int       @id @default(autoincrement())
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  resena      Boolean
  idPedido    Int
  pedido      Pedido    @relation(fields: [idPedido], references: [id])
  idProveedor String
  proveedor   Proveedor @relation(fields: [idProveedor], references: [email])
}

enum estadoPedido {
  pedidoRealizado
  enviado
  enReparto
  entregado
}

model ProductosPedido {
  id         Int      @id @default(autoincrement())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  precio     Float
  cantidad   Int
  resena     Boolean
  idProducto Int
  producto   Producto @relation(fields: [idProducto], references: [id])
  idPedido   Int
  pedido     Pedido   @relation(fields: [idPedido], references: [id])
}
